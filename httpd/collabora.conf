<VirtualHost *:80>
    ServerName COLLABORA_PUBLIC_HOST

    Alias "/.well-known/acme-challenge" "/var/www/certbot/.well-known/acme-challenge"
    <Directory "/var/www/certbot">
        Require all granted
        Options None
        AllowOverride None
        ForceType text/plain
        RedirectMatch 404 "^(?!/\.well-known/acme-challenge/[\w-]{43}$)"
    </Directory>
</VirtualHost>


<IfFile "/etc/letsencrypt/live/COLLABORA_PUBLIC_HOST/privkey.pem">
    <VirtualHost *:9980>
        ServerName COLLABORA_PUBLIC_HOST

        SSLEngine on
        SSLCertificateFile /etc/letsencrypt/live/COLLABORA_PUBLIC_HOST/fullchain.pem
        SSLCertificateKeyFile /etc/letsencrypt/live/COLLABORA_PUBLIC_HOST/privkey.pem

        ProxyPreserveHost On
        ProxyPass "/" "http://collabora:9980/"
        ProxyPassReverse "/" "http://collabora:9980/"
    </VirtualHost>

    # modern configuration
    SSLProtocol             all -SSLv3 -TLSv1 -TLSv1.1 -TLSv1.2
    SSLHonorCipherOrder     off
    SSLSessionTickets       off

    SSLUseStapling On
    SSLStaplingCache "shmcb:logs/ssl_stapling(32768)"
</IfFile>
